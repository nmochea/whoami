<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Android WebView Legacy + Modern Permission Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
    background:#020617;
    color:#e5e7eb;
    font-family: monospace;
    padding:14px;
}
h1 { color:#fb7185; }
pre {
    background:#020617;
    border:1px solid #1f2933;
    padding:10px;
    max-height:70vh;
    overflow:auto;
}
.bad { color:#f87171; }
.good { color:#4ade80; }
.warn { color:#facc15; }
</style>
</head>

<body>
<h1>Android WebView Insecure Auto Test</h1>
<pre id="log"></pre>

<script>
const log = (m, c="") => {
    const el = document.getElementById("log");
    el.innerHTML += c ? `<span class="${c}">${m}</span>\n` : m + "\n";
};

/* ======================================================
   MODERN MEDIA DEVICES
====================================================== */
(async () => {
    try {
        const s = await navigator.mediaDevices.getUserMedia({video:true});
        log("[MODERN CAMERA] AUTO-GRANTED ❌", "bad");
        s.getTracks().forEach(t=>t.stop());
    } catch(e) {
        log("[MODERN CAMERA] blocked / prompt ✔", "good");
    }
})();

(async () => {
    try {
        const s = await navigator.mediaDevices.getUserMedia({audio:true});
        log("[MODERN MIC] AUTO-GRANTED ❌", "bad");
        s.getTracks().forEach(t=>t.stop());
    } catch(e) {
        log("[MODERN MIC] blocked / prompt ✔", "good");
    }
})();

/* ======================================================
   LEGACY getUserMedia (OLD WEBVIEW)
====================================================== */
(() => {
    const gum =
        navigator.getUserMedia ||
        navigator.webkitGetUserMedia ||
        navigator.mozGetUserMedia;

    if (!gum) {
        log("[LEGACY GUM] API unavailable", "warn");
        return;
    }

    gum.call(navigator,
        { video:true, audio:true },
        stream => {
            log("[LEGACY GUM] AUTO-GRANTED ❌", "bad");
            stream.getTracks().forEach(t=>t.stop());
        },
        err => log("[LEGACY GUM] blocked ✔", "good")
    );
})();

/* ======================================================
   GEOLOCATION (OLD + NEW)
====================================================== */
if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
        p => log(`[GEO] AUTO-GRANTED ❌ ${p.coords.latitude},${p.coords.longitude}`, "bad"),
        _ => log("[GEO] blocked / prompt ✔", "good"),
        { timeout: 3000 }
    );
} else {
    log("[GEO] API unavailable");
}

/* ======================================================
   CLIPBOARD (MODERN + LEGACY)
====================================================== */
(async () => {
    if (navigator.clipboard) {
        try {
            const txt = await navigator.clipboard.readText();
            log("[CLIPBOARD MODERN] READ ❌ -> " + txt, "bad");
        } catch {
            log("[CLIPBOARD MODERN] blocked ✔", "good");
        }
    } else {
        log("[CLIPBOARD MODERN] unavailable", "warn");
    }
})();

/* Legacy execCommand (rare but still works in old WebView) */
(() => {
    try {
        const ok = document.execCommand("paste");
        if (ok) log("[CLIPBOARD LEGACY] paste succeeded ❌", "bad");
        else log("[CLIPBOARD LEGACY] blocked ✔", "good");
    } catch {
        log("[CLIPBOARD LEGACY] blocked ✔", "good");
    }
})();

/* ======================================================
   SENSORS (NO PERMISSION IN OLD WEBVIEW)
====================================================== */
let sensorHit = false;

window.addEventListener("devicemotion", () => {
    if (!sensorHit) {
        sensorHit = true;
        log("[SENSOR] DeviceMotion event ❌", "bad");
    }
});

window.addEventListener("deviceorientation", () => {
    if (!sensorHit) {
        sensorHit = true;
        log("[SENSOR] DeviceOrientation event ❌", "bad");
    }
});

setTimeout(() => {
    if (!sensorHit) log("[SENSOR] no sensor events ✔", "good");
}, 2000);

/* ======================================================
   FILE:// ACCESS (OLD WEBVIEW BUG CLASS)
====================================================== */
(async () => {
    try {
        const r = await fetch("file:///proc/self/status");
        log("[FILE] file:// ACCESS ❌ status=" + r.status, "bad");
    } catch {
        log("[FILE] file:// blocked ✔", "good");
    }
})();

/* ======================================================
   JS BRIDGE (LEGACY HYBRID APPS)
====================================================== */
(() => {
    if (window.Android) {
        log("[JS BRIDGE] window.Android exposed ❌", "bad");
        for (let k in window.Android)
            log("  ↳ method: " + k, "bad");
    } else {
        log("[JS BRIDGE] not exposed ✔", "good");
    }
})();

/* ======================================================
   PERMISSIONS API (NEWER WEBVIEW)
====================================================== */
(async () => {
    if (!navigator.permissions) {
        log("[PERMS] API unavailable", "warn");
        return;
    }

    for (const p of ["camera","microphone","geolocation","clipboard-read"]) {
        try {
            const r = await navigator.permissions.query({name:p});
            log(`[PERMS] ${p}: ${r.state} ${r.state==="granted"?"❌":"✔"}`,
                r.state==="granted"?"bad":"good");
        } catch {
            log(`[PERMS] ${p}: unsupported`);
        }
    }
})();

log("=== Auto-trigger completed (modern + legacy APIs) ===");
</script>

</body>
</html>
